<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your AI Literacy Snapshot</title>

  <!-- Use your existing stylesheet -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* Minimal safe defaults; your style.css will override where defined */
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; line-height: 1.5; color: #e9ecf1; background: #0b0d10; }
    .container { max-width: 880px; margin: 24px auto; padding: 0 16px; }
    .card { background: #12151a; border: 1px solid #243042; border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1 { margin: 0 0 8px; font-size: 28px; }
    .muted { color: #aab2bf; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #31405a; background:#dfe6ff1a; color:#cfd7ff; font-weight:700; margin-bottom:10px;}
    .overall { display:flex; align-items:center; gap:14px; background:#0f1319; border:1px solid #243042; padding:16px; border-radius:12px; margin:12px 0 18px }
    .overall .score { font-size:28px; font-weight:800; background:#0c1118; padding:10px 14px; border-radius:12px; border:1px solid #243042 }
    .metric { display:grid; grid-template-columns:220px 1fr 110px; gap:16px; align-items:center }
    .metric + .metric { margin-top:12px }
    .bar { height:12px; background:#e9ecf1; border-radius:9999px; overflow:hidden }
    .bar > span { display:block; height:100%; background:#b5b9ff; width:0 }
    .row { margin-top: 18px; display:flex; gap:12px; flex-wrap:wrap; }
    .btn { padding:10px 14px; border-radius:12px; border:1px solid #243042; background:#0f1319; color:#e9ecf1; cursor:pointer; text-decoration:none; }
    .btn:hover { background:#151c28; }
    .footer-note { color:#9aa3b3; font-size:13px; margin-top:10px }
  </style>
</head>
<body>
  <div class="container">
    <span class="pill" id="levelPill">—</span>
    <h1>Your AI Literacy Snapshot</h1>
    <p class="muted">Below is your personalized snapshot. Your result is already recorded automatically for reporting.</p>

    <div class="card">
      <div class="overall">
        <div>
          <div class="muted">Overall score</div>
          <div class="score" id="overallScore">0.0 / 5</div>
        </div>
        <div class="muted" id="buLine" style="margin-left:auto;">Business Unit: —</div>
      </div>

      <div id="metrics"></div>

      <div class="row">
        <a class="btn" href="index.html">Retake assessment</a>
      </div>
      <div class="footer-note">No emails are sent. Submissions are logged automatically (timestamp, BU, and category scores).</div>
    </div>
  </div>

  <script>
    // Labels to match your UI
    const CAT_LABELS = {
      safe: "Safe & Responsible Use",
      everyday: "Everyday Use",
      prompting: "Prompting & Iteration",
      process: "Process & Quality",
      integration: "Integration & Improvement",
      sharing: "Sharing & Collaboration",
      productivity: "Productivity"
    };

    // Default order (Productivity added dynamically if present)
    const ORDER = ["safe","everyday","prompting","process","integration","sharing"];

    function levelFromScore(s){
      if(s >= 4.5) return "Expert";
      if(s >= 4.0) return "Advanced";
      if(s >= 3.5) return "Strong";
      if(s >= 3.0) return "Building";
      return "Starting";
    }

    function renderBarRow(name, value){
      const pct = Math.max(0, Math.min(100, (Number(value||0)/5)*100));
      const row = document.createElement('div');
      row.className = "metric";
      row.innerHTML = `
        <div>${name}</div>
        <div class="bar"><span style="width:${pct}%"></span></div>
        <div>${(Number(value)||0).toFixed(1)}/5</div>
      `;
      return row;
    }

    function readPayloadFromParam(){
      const p = new URLSearchParams(location.search).get("p");
      if(!p) return null;
      try { return JSON.parse(atob(p)); } catch { return null; }
    }

    function readBusinessUnit(){
      try {
        const ls = JSON.parse(localStorage.getItem("aiQuizResult") || "{}");
        if (ls && ls.businessUnit) return ls.businessUnit;
      } catch {}
      return null;
    }

    (function init(){
      const data = readPayloadFromParam() || {};
      const bu = readBusinessUnit();

      const categories = {};
      ORDER.forEach(k => { if (typeof data[k] === "number") categories[k] = data[k]; });
      if (typeof data.productivity === "number") {
        categories.productivity = data.productivity;
        if (!ORDER.includes("productivity")) ORDER.push("productivity");
      }

      const overall = Number(data.overall || 0);
      document.getElementById("overallScore").textContent = `${overall.toFixed(1)} / 5`;
      document.getElementById("levelPill").textContent = levelFromScore(overall);
      if (bu) document.getElementById("buLine").textContent = `Business Unit: ${bu}`;

      const metricsEl = document.getElementById("metrics");
      metricsEl.innerHTML = "";
      ORDER.forEach(cat => {
        if (typeof categories[cat] === "number") {
          metricsEl.appendChild(renderBarRow(CAT_LABELS[cat] || cat, categories[cat]));
        }
      });
    })();
  </script>
</body>
</html>
